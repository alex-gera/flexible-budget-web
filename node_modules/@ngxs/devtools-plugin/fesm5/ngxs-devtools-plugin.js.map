{"version":3,"file":"ngxs-devtools-plugin.js.map","sources":["ng://@ngxs/devtools-plugin/src/symbols.ts","ng://@ngxs/devtools-plugin/src/devtools.plugin.ts","ng://@ngxs/devtools-plugin/src/devtools.module.ts"],"sourcesContent":["import { InjectionToken } from '@angular/core';\r\n\r\n/**\r\n * Interface for the redux-devtools-extension API.\r\n */\r\nexport interface NgxsDevtoolsExtension {\r\n  init(state);\r\n  send(action: any, state?: any);\r\n  subscribe(fn: (message: NgxsDevtoolsAction) => void);\r\n}\r\n\r\nexport interface NgxsDevtoolsAction {\r\n  type: string;\r\n  payload: any;\r\n  state: any;\r\n  id: number;\r\n  source: string;\r\n}\r\n\r\nexport interface NgxsDevtoolsOptions {\r\n  /**\r\n   * The name of the extension\r\n   */\r\n  name?: string;\r\n\r\n  /**\r\n   * Whether the dev tools is enabled or note. Useful for setting during production.\r\n   */\r\n  disabled?: boolean;\r\n\r\n  /**\r\n   * Max number of entiries to keep.\r\n   */\r\n  maxAge?: number;\r\n\r\n  /**\r\n   * Reformat actions before sending to dev tools\r\n   */\r\n  actionSanitizer?: (action: any) => void;\r\n\r\n  /**\r\n   * Reformat state before sending to devtools\r\n   */\r\n  stateSanitizer?: (state: any) => void;\r\n}\r\n\r\nexport const NGXS_DEVTOOLS_OPTIONS = new InjectionToken('NGXS_DEVTOOLS_OPTIONS');\r\n","import { Injectable, Inject, Injector } from '@angular/core';\r\nimport { NgxsPlugin, getActionTypeFromInstance, Store } from '@ngxs/store';\r\nimport { tap } from 'rxjs/operators';\r\n\r\nimport { NgxsDevtoolsExtension, NgxsDevtoolsOptions, NGXS_DEVTOOLS_OPTIONS, NgxsDevtoolsAction } from './symbols';\r\n\r\n/**\r\n * Adds support for the Redux Devtools extension:\r\n * http://extension.remotedev.io/\r\n */\r\n@Injectable()\r\nexport class NgxsReduxDevtoolsPlugin implements NgxsPlugin {\r\n  private readonly devtoolsExtension: NgxsDevtoolsExtension | null = null;\r\n  private readonly windowObj: any = typeof window !== 'undefined' ? window : {};\r\n\r\n  constructor(@Inject(NGXS_DEVTOOLS_OPTIONS) private _options: NgxsDevtoolsOptions, private _injector: Injector) {\r\n    const globalDevtools = this.windowObj['__REDUX_DEVTOOLS_EXTENSION__'] || this.windowObj['devToolsExtension'];\r\n    if (globalDevtools) {\r\n      this.devtoolsExtension = globalDevtools.connect(_options) as NgxsDevtoolsExtension;\r\n      this.devtoolsExtension.subscribe(a => this.dispatched(a));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Middleware handle function\r\n   */\r\n  handle(state: any, action: any, next: any) {\r\n    const isDisabled = this._options && this._options.disabled;\r\n    if (!this.devtoolsExtension || isDisabled) {\r\n      return next(state, action);\r\n    }\r\n\r\n    return next(state, action).pipe(\r\n      tap(newState => {\r\n        // if init action, send initial state to dev tools\r\n        const isInitAction = getActionTypeFromInstance(action) === '@@INIT';\r\n        if (isInitAction) {\r\n          this.devtoolsExtension.init(state);\r\n        } else {\r\n          const type = getActionTypeFromInstance(action);\r\n\r\n          this.devtoolsExtension.send({ ...action, type }, newState);\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handle the action from the dev tools subscription\r\n   */\r\n  dispatched(action: NgxsDevtoolsAction) {\r\n    // Lazy get the store for circular depedency issues\r\n    const store = this._injector.get(Store);\r\n    if (action.type === 'DISPATCH') {\r\n      if (action.payload.type === 'JUMP_TO_ACTION' || action.payload.type === 'JUMP_TO_STATE') {\r\n        const prevState = JSON.parse(action.state);\r\n        store.reset(prevState);\r\n      } else if (action.payload.type === 'TOGGLE_ACTION') {\r\n        console.warn('Skip is not supported at this time.');\r\n      } else if (action.payload.type === 'IMPORT_STATE') {\r\n        const { actionsById, computedStates, currentStateIndex } = action.payload.nextLiftedState;\r\n        this.devtoolsExtension.init(computedStates[0].state);\r\n        Object.keys(actionsById)\r\n          .filter(actionId => actionId !== '0')\r\n          .forEach(actionId => this.devtoolsExtension.send(actionsById[actionId], computedStates[actionId].state));\r\n        store.reset(computedStates[currentStateIndex].state);\r\n      }\r\n    } else if (action.type === 'ACTION') {\r\n      const actionPayload = JSON.parse(action.payload);\r\n      store.dispatch(actionPayload);\r\n    }\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders, InjectionToken } from '@angular/core';\r\nimport { NgxsModule, NGXS_PLUGINS } from '@ngxs/store';\r\n\r\nimport { NgxsDevtoolsOptions, NGXS_DEVTOOLS_OPTIONS } from './symbols';\r\nimport { NgxsReduxDevtoolsPlugin } from './devtools.plugin';\r\n\r\nexport function devtoolsOptionsFactory(options: NgxsDevtoolsOptions) {\r\n  return {\r\n    name: 'NGXS',\r\n    ...options\r\n  };\r\n}\r\n\r\nexport const USER_OPTIONS = new InjectionToken('USER_OPTIONS');\r\n\r\n@NgModule({\r\n  imports: [NgxsModule]\r\n})\r\nexport class NgxsReduxDevtoolsPluginModule {\r\n  static forRoot(options?: NgxsDevtoolsOptions): ModuleWithProviders {\r\n    return {\r\n      ngModule: NgxsReduxDevtoolsPluginModule,\r\n      providers: [\r\n        {\r\n          provide: NGXS_PLUGINS,\r\n          useClass: NgxsReduxDevtoolsPlugin,\r\n          multi: true\r\n        },\r\n        {\r\n          provide: USER_OPTIONS,\r\n          useValue: options\r\n        },\r\n        {\r\n          provide: NGXS_DEVTOOLS_OPTIONS,\r\n          useFactory: devtoolsOptionsFactory,\r\n          deps: [USER_OPTIONS]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}
