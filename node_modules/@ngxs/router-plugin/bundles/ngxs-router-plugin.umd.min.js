!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/router"),require("@ngxs/store"),require("rxjs"),require("@angular/core")):"function"==typeof define&&define.amd?define("@ngxs/router-plugin",["exports","@angular/router","@ngxs/store","rxjs","@angular/core"],e):e((t.ngxs=t.ngxs||{},t.ngxs["router-plugin"]={}),t.ng.router,t["ngxs-store"],t.rxjs,t.ng.core)}(this,function(t,n,e,o,i){"use strict";var a=function R(){},r=function(){function t(){}return t.prototype.serialize=function(t){return{root:this.serializeRoute(t.root),url:t.url}},t.prototype.serializeRoute=function(t){var e=this,r=t.children.map(function(t){return e.serializeRoute(t)});return{url:t.url,params:t.params,queryParams:t.queryParams,fragment:t.fragment,data:t.data,outlet:t.outlet,component:undefined,routeConfig:null,root:undefined,parent:undefined,firstChild:r[0],children:r,pathFromRoot:undefined,paramMap:t.paramMap,queryParamMap:t.queryParamMap,toString:t.toString}},t}(),u=function(){return(u=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function s(t,e,r,n){var o,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;0<=u;u--)(o=t[u])&&(a=(i<3?o(a):3<i?o(e,r,a):o(e,r))||a);return 3<i&&a&&Object.defineProperty(e,r,a),a}function c(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var p=function(){function t(t,e,r){this.path=t,this.queryParams=e,this.extras=r}return Object.defineProperty(t,"type",{get:function(){return"[Router] Navigate"},enumerable:!0,configurable:!0}),t}(),g=function(){function t(t,e){this.routerState=t,this.event=e}return Object.defineProperty(t,"type",{get:function(){return"[Router] RouterNavigation"},enumerable:!0,configurable:!0}),t}(),l=function(){function t(t,e,r){this.routerState=t,this.storeState=e,this.event=r}return Object.defineProperty(t,"type",{get:function(){return"[Router] RouterCancel"},enumerable:!0,configurable:!0}),t}(),f=function(){function t(t,e,r){this.routerState=t,this.storeState=e,this.event=r}return Object.defineProperty(t,"type",{get:function(){return"[Router] RouterError"},enumerable:!0,configurable:!0}),t}(),h=function(){function t(t,e,r,n){this._store=t,this._router=e,this._serializer=r,this._ngZone=n,this.dispatchTriggeredByRouter=!1,this.navigationTriggeredByDispatch=!1,this.setUpRouterHook(),this.setUpStoreListener(),this.setUpStateRollbackEvents()}var r;return(r=t).state=function(t){return t&&t.state},t.url=function(t){return t&&t.state&&t.state.url},t.prototype.navigate=function(t,e){var r=this;this._ngZone.run(function(){return r._router.navigate(e.path,u({queryParams:e.queryParams},e.extras))})},t.prototype.angularRouterAction=function(t,e){t.setState(u({},t.getState(),{state:e.routerState,navigationId:e.event.id}))},t.prototype.setUpRouterHook=function(){var e=this;this._router.hooks.beforePreactivation=function(t){return e.routerStateSnapshot=e._serializer.serialize(t),e.shouldDispatchRouterNavigation()&&e.dispatchRouterNavigation(),o.of(!0)}},t.prototype.setUpStoreListener=function(){var e=this;this._store.select(r).subscribe(function(t){e.routerState=t}),this._store.select(r.state).subscribe(function(){e.navigateIfNeeded()})},t.prototype.setUpStateRollbackEvents=function(){var e=this;this._router.events.subscribe(function(t){t instanceof n.RoutesRecognized?e.lastRoutesRecognized=t:t instanceof n.NavigationCancel?e.dispatchRouterCancel(t):t instanceof n.NavigationError&&e.dispatchRouterError(t)})},t.prototype.shouldDispatchRouterNavigation=function(){return!this.routerState||!this.navigationTriggeredByDispatch},t.prototype.navigateIfNeeded=function(){var t=this;this.routerState&&this.routerState.state&&(this.dispatchTriggeredByRouter||this._router.url!==this.routerState.state.url&&(this.navigationTriggeredByDispatch=!0,this._ngZone.run(function(){return t._router.navigateByUrl(t.routerState.state.url)})))},t.prototype.dispatchRouterNavigation=function(){this.dispatchRouterAction(new g(this.routerStateSnapshot,new n.RoutesRecognized(this.lastRoutesRecognized.id,this.lastRoutesRecognized.url,this.lastRoutesRecognized.urlAfterRedirects,this.routerStateSnapshot)))},t.prototype.dispatchRouterCancel=function(t){this.dispatchRouterAction(new l(this.routerStateSnapshot,this.routerState,t))},t.prototype.dispatchRouterError=function(t){this.dispatchRouterAction(new f(this.routerStateSnapshot,this.routerState,new n.NavigationError(t.id,t.url,""+t)))},t.prototype.dispatchRouterAction=function(t){this.dispatchTriggeredByRouter=!0;try{this._store.dispatch(t)}finally{this.dispatchTriggeredByRouter=!1,this.navigationTriggeredByDispatch=!1}},s([e.Action(p),c("design:type",Function),c("design:paramtypes",[Object,p]),c("design:returntype",void 0)],t.prototype,"navigate",null),s([e.Action([g,f,l]),c("design:type",Function),c("design:paramtypes",[Object,Object]),c("design:returntype",void 0)],t.prototype,"angularRouterAction",null),s([e.Selector(),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],t,"state",null),s([e.Selector(),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",String)],t,"url",null),t=r=s([e.State({name:"router",defaults:{state:null,navigationId:null}}),c("design:paramtypes",[e.Store,n.Router,a,i.NgZone])],t)}(),d=e.NgxsModule.forFeature([h]),y=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[]}},t.decorators=[{type:i.NgModule,args:[{imports:[d],providers:[{provide:a,useClass:r}]}]}],t}();t.NgxsRouterPluginModule=y,t.RouterState=h,t.RouterStateSerializer=a,t.DefaultRouterStateSerializer=r,t.Navigate=p,t.RouterNavigation=g,t.RouterCancel=l,t.RouterError=f,t.Éµa=d,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngxs-router-plugin.umd.min.js.map